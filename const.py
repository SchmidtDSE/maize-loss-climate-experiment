"""Constants and simple utilities shared across pipeline task modules.

License:
    BSD
"""

import os
import re


GEOHASH_LEN = 4
WORKSPACE_DIR = 'workspace'
CLUSTER_NAME = 'maize-insurance-adapt-cluster'
START_WORKERS = 10
BUCKET_OR_DIR = os.environ.get('SOURCE_DATA_LOC', '')
SAMPLE_DAY_GAP = 1

EPOCHS = 40
LEARNING_RATE = 0.0005
MEAN_WEIGHT = 1
STD_WEIGHT = 1 / 4

HISTORIC_TRAINING_FILENAME = 'training_historic.csv'

EXPECTED_CLIMATE_COLS = [
    'geohash',
    'year',
    'month',
    'var',
    'condition',
    'mean',
    'std',
    'min',
    'max',
    'count',
    'skew',
    'kurtosis'
]

CLIMATE_VARIABLES = [
    'RHx',
    'RHn',
    'Tmax',
    'Tmin',
    'chirps-v2',
    'svp',
    'vpd',
    'wbgtmax'
]

CLIMATE_VARIABLE_TO_ATTR = {
    'RHx': 'rhx',
    'RHn': 'rhn',
    'Tmax': 'tmax',
    'Tmin': 'tmin',
    'chirps-v2': 'chirps',
    'svp': 'svp',
    'vpd': 'vpd',
    'wbgtmax': 'wbgtmax'
}

CONDITIONS = [
    '2030_SSP245',
    '2050_SSP245',
    'observations'
]

FUTURE_CONDITIONS = [
    '2030_SSP245',
    '2050_SSP245'
]

FUTURE_REF_YEARS = [1999, 2001, 2003, 2005, 2007, 2009, 2011, 2013, 2015]

YEARS = list(range(1999, 2016 + 1))

YEAR_REGEX = re.compile('scymBiomass_beltStates_(\\d+)[^\\.]*\\.tif')

SPLIT_CLIMATE_PREPROCESS = True

GEOHASH_YIELD_COLS = [
    'year',
    'geohash',
    'mean',
    'std',
    'count',
    'skew',
    'kurtosis'
]

GEOHASH_YIELD_BETA_COLS = GEOHASH_YIELD_COLS + [
    'a',
    'b',
    'loc',
    'scale'
]

TRAINING_FRAME_BASE_ATTRS = [
    'year',
    'geohash',
    'baselineYieldMean',
    'baselineYieldStd',
    'rhnMean1',
    'rhnStd1',
    'rhnMin1',
    'rhnMax1',
    'rhnCount1',
    'rhxMean1',
    'rhxStd1',
    'rhxMin1',
    'rhxMax1',
    'rhxCount1',
    'tmaxMean1',
    'tmaxStd1',
    'tmaxMin1',
    'tmaxMax1',
    'tmaxCount1',
    'tminMean1',
    'tminStd1',
    'tminMin1',
    'tminMax1',
    'tminCount1',
    'chirpsMean1',
    'chirpsStd1',
    'chirpsMin1',
    'chirpsMax1',
    'chirpsCount1',
    'svpMean1',
    'svpStd1',
    'svpMin1',
    'svpMax1',
    'svpCount1',
    'vpdMean1',
    'vpdStd1',
    'vpdMin1',
    'vpdMax1',
    'vpdCount1',
    'wbgtmaxMean1',
    'wbgtmaxStd1',
    'wbgtmaxMin1',
    'wbgtmaxMax1',
    'wbgtmaxCount1',
    'rhnMean2',
    'rhnStd2',
    'rhnMin2',
    'rhnMax2',
    'rhnCount2',
    'rhxMean2',
    'rhxStd2',
    'rhxMin2',
    'rhxMax2',
    'rhxCount2',
    'tmaxMean2',
    'tmaxStd2',
    'tmaxMin2',
    'tmaxMax2',
    'tmaxCount2',
    'tminMean2',
    'tminStd2',
    'tminMin2',
    'tminMax2',
    'tminCount2',
    'chirpsMean2',
    'chirpsStd2',
    'chirpsMin2',
    'chirpsMax2',
    'chirpsCount2',
    'svpMean2',
    'svpStd2',
    'svpMin2',
    'svpMax2',
    'svpCount2',
    'vpdMean2',
    'vpdStd2',
    'vpdMin2',
    'vpdMax2',
    'vpdCount2',
    'wbgtmaxMean2',
    'wbgtmaxStd2',
    'wbgtmaxMin2',
    'wbgtmaxMax2',
    'wbgtmaxCount2',
    'rhnMean3',
    'rhnStd3',
    'rhnMin3',
    'rhnMax3',
    'rhnCount3',
    'rhxMean3',
    'rhxStd3',
    'rhxMin3',
    'rhxMax3',
    'rhxCount3',
    'tmaxMean3',
    'tmaxStd3',
    'tmaxMin3',
    'tmaxMax3',
    'tmaxCount3',
    'tminMean3',
    'tminStd3',
    'tminMin3',
    'tminMax3',
    'tminCount3',
    'chirpsMean3',
    'chirpsStd3',
    'chirpsMin3',
    'chirpsMax3',
    'chirpsCount3',
    'svpMean3',
    'svpStd3',
    'svpMin3',
    'svpMax3',
    'svpCount3',
    'vpdMean3',
    'vpdStd3',
    'vpdMin3',
    'vpdMax3',
    'vpdCount3',
    'wbgtmaxMean3',
    'wbgtmaxStd3',
    'wbgtmaxMin3',
    'wbgtmaxMax3',
    'wbgtmaxCount3',
    'rhnMean4',
    'rhnStd4',
    'rhnMin4',
    'rhnMax4',
    'rhnCount4',
    'rhxMean4',
    'rhxStd4',
    'rhxMin4',
    'rhxMax4',
    'rhxCount4',
    'tmaxMean4',
    'tmaxStd4',
    'tmaxMin4',
    'tmaxMax4',
    'tmaxCount4',
    'tminMean4',
    'tminStd4',
    'tminMin4',
    'tminMax4',
    'tminCount4',
    'chirpsMean4',
    'chirpsStd4',
    'chirpsMin4',
    'chirpsMax4',
    'chirpsCount4',
    'svpMean4',
    'svpStd4',
    'svpMin4',
    'svpMax4',
    'svpCount4',
    'vpdMean4',
    'vpdStd4',
    'vpdMin4',
    'vpdMax4',
    'vpdCount4',
    'wbgtmaxMean4',
    'wbgtmaxStd4',
    'wbgtmaxMin4',
    'wbgtmaxMax4',
    'wbgtmaxCount4',
    'rhnMean5',
    'rhnStd5',
    'rhnMin5',
    'rhnMax5',
    'rhnCount5',
    'rhxMean5',
    'rhxStd5',
    'rhxMin5',
    'rhxMax5',
    'rhxCount5',
    'tmaxMean5',
    'tmaxStd5',
    'tmaxMin5',
    'tmaxMax5',
    'tmaxCount5',
    'tminMean5',
    'tminStd5',
    'tminMin5',
    'tminMax5',
    'tminCount5',
    'chirpsMean5',
    'chirpsStd5',
    'chirpsMin5',
    'chirpsMax5',
    'chirpsCount5',
    'svpMean5',
    'svpStd5',
    'svpMin5',
    'svpMax5',
    'svpCount5',
    'vpdMean5',
    'vpdStd5',
    'vpdMin5',
    'vpdMax5',
    'vpdCount5',
    'wbgtmaxMean5',
    'wbgtmaxStd5',
    'wbgtmaxMin5',
    'wbgtmaxMax5',
    'wbgtmaxCount5',
    'rhnMean6',
    'rhnStd6',
    'rhnMin6',
    'rhnMax6',
    'rhnCount6',
    'rhxMean6',
    'rhxStd6',
    'rhxMin6',
    'rhxMax6',
    'rhxCount6',
    'tmaxMean6',
    'tmaxStd6',
    'tmaxMin6',
    'tmaxMax6',
    'tmaxCount6',
    'tminMean6',
    'tminStd6',
    'tminMin6',
    'tminMax6',
    'tminCount6',
    'chirpsMean6',
    'chirpsStd6',
    'chirpsMin6',
    'chirpsMax6',
    'chirpsCount6',
    'svpMean6',
    'svpStd6',
    'svpMin6',
    'svpMax6',
    'svpCount6',
    'vpdMean6',
    'vpdStd6',
    'vpdMin6',
    'vpdMax6',
    'vpdCount6',
    'wbgtmaxMean6',
    'wbgtmaxStd6',
    'wbgtmaxMin6',
    'wbgtmaxMax6',
    'wbgtmaxCount6',
    'rhnMean7',
    'rhnStd7',
    'rhnMin7',
    'rhnMax7',
    'rhnCount7',
    'rhxMean7',
    'rhxStd7',
    'rhxMin7',
    'rhxMax7',
    'rhxCount7',
    'tmaxMean7',
    'tmaxStd7',
    'tmaxMin7',
    'tmaxMax7',
    'tmaxCount7',
    'tminMean7',
    'tminStd7',
    'tminMin7',
    'tminMax7',
    'tminCount7',
    'chirpsMean7',
    'chirpsStd7',
    'chirpsMin7',
    'chirpsMax7',
    'chirpsCount7',
    'svpMean7',
    'svpStd7',
    'svpMin7',
    'svpMax7',
    'svpCount7',
    'vpdMean7',
    'vpdStd7',
    'vpdMin7',
    'vpdMax7',
    'vpdCount7',
    'wbgtmaxMean7',
    'wbgtmaxStd7',
    'wbgtmaxMin7',
    'wbgtmaxMax7',
    'wbgtmaxCount7',
    'rhnMean8',
    'rhnStd8',
    'rhnMin8',
    'rhnMax8',
    'rhnCount8',
    'rhxMean8',
    'rhxStd8',
    'rhxMin8',
    'rhxMax8',
    'rhxCount8',
    'tmaxMean8',
    'tmaxStd8',
    'tmaxMin8',
    'tmaxMax8',
    'tmaxCount8',
    'tminMean8',
    'tminStd8',
    'tminMin8',
    'tminMax8',
    'tminCount8',
    'chirpsMean8',
    'chirpsStd8',
    'chirpsMin8',
    'chirpsMax8',
    'chirpsCount8',
    'svpMean8',
    'svpStd8',
    'svpMin8',
    'svpMax8',
    'svpCount8',
    'vpdMean8',
    'vpdStd8',
    'vpdMin8',
    'vpdMax8',
    'vpdCount8',
    'wbgtmaxMean8',
    'wbgtmaxStd8',
    'wbgtmaxMin8',
    'wbgtmaxMax8',
    'wbgtmaxCount8',
    'rhnMean9',
    'rhnStd9',
    'rhnMin9',
    'rhnMax9',
    'rhnCount9',
    'rhxMean9',
    'rhxStd9',
    'rhxMin9',
    'rhxMax9',
    'rhxCount9',
    'tmaxMean9',
    'tmaxStd9',
    'tmaxMin9',
    'tmaxMax9',
    'tmaxCount9',
    'tminMean9',
    'tminStd9',
    'tminMin9',
    'tminMax9',
    'tminCount9',
    'chirpsMean9',
    'chirpsStd9',
    'chirpsMin9',
    'chirpsMax9',
    'chirpsCount9',
    'svpMean9',
    'svpStd9',
    'svpMin9',
    'svpMax9',
    'svpCount9',
    'vpdMean9',
    'vpdStd9',
    'vpdMin9',
    'vpdMax9',
    'vpdCount9',
    'wbgtmaxMean9',
    'wbgtmaxStd9',
    'wbgtmaxMin9',
    'wbgtmaxMax9',
    'wbgtmaxCount9',
    'rhnMean10',
    'rhnStd10',
    'rhnMin10',
    'rhnMax10',
    'rhnCount10',
    'rhxMean10',
    'rhxStd10',
    'rhxMin10',
    'rhxMax10',
    'rhxCount10',
    'tmaxMean10',
    'tmaxStd10',
    'tmaxMin10',
    'tmaxMax10',
    'tmaxCount10',
    'tminMean10',
    'tminStd10',
    'tminMin10',
    'tminMax10',
    'tminCount10',
    'chirpsMean10',
    'chirpsStd10',
    'chirpsMin10',
    'chirpsMax10',
    'chirpsCount10',
    'svpMean10',
    'svpStd10',
    'svpMin10',
    'svpMax10',
    'svpCount10',
    'vpdMean10',
    'vpdStd10',
    'vpdMin10',
    'vpdMax10',
    'vpdCount10',
    'wbgtmaxMean10',
    'wbgtmaxStd10',
    'wbgtmaxMin10',
    'wbgtmaxMax10',
    'wbgtmaxCount10',
    'rhnMean11',
    'rhnStd11',
    'rhnMin11',
    'rhnMax11',
    'rhnCount11',
    'rhxMean11',
    'rhxStd11',
    'rhxMin11',
    'rhxMax11',
    'rhxCount11',
    'tmaxMean11',
    'tmaxStd11',
    'tmaxMin11',
    'tmaxMax11',
    'tmaxCount11',
    'tminMean11',
    'tminStd11',
    'tminMin11',
    'tminMax11',
    'tminCount11',
    'chirpsMean11',
    'chirpsStd11',
    'chirpsMin11',
    'chirpsMax11',
    'chirpsCount11',
    'svpMean11',
    'svpStd11',
    'svpMin11',
    'svpMax11',
    'svpCount11',
    'vpdMean11',
    'vpdStd11',
    'vpdMin11',
    'vpdMax11',
    'vpdCount11',
    'wbgtmaxMean11',
    'wbgtmaxStd11',
    'wbgtmaxMin11',
    'wbgtmaxMax11',
    'wbgtmaxCount11',
    'rhnMean12',
    'rhnStd12',
    'rhnMin12',
    'rhnMax12',
    'rhnCount12',
    'rhxMean12',
    'rhxStd12',
    'rhxMin12',
    'rhxMax12',
    'rhxCount12',
    'tmaxMean12',
    'tmaxStd12',
    'tmaxMin12',
    'tmaxMax12',
    'tmaxCount12',
    'tminMean12',
    'tminStd12',
    'tminMin12',
    'tminMax12',
    'tminCount12',
    'chirpsMean12',
    'chirpsStd12',
    'chirpsMin12',
    'chirpsMax12',
    'chirpsCount12',
    'svpMean12',
    'svpStd12',
    'svpMin12',
    'svpMax12',
    'svpCount12',
    'vpdMean12',
    'vpdStd12',
    'vpdMin12',
    'vpdMax12',
    'vpdCount12',
    'wbgtmaxMean12',
    'wbgtmaxStd12',
    'wbgtmaxMin12',
    'wbgtmaxMax12',
    'wbgtmaxCount12',
    'climateCounts',
    'yieldObservations'
]

TRAINING_FRAME_ATTRS = TRAINING_FRAME_BASE_ATTRS + ['yieldMean', 'yieldStd']

TRAINING_FRAME_BETA_ATTRS = TRAINING_FRAME_BASE_ATTRS + [
    'yieldA',
    'yieldB',
    'yieldLoc',
    'yieldScale'
]

INCLUDE_COUNT_IN_MODEL = False
INCLUDE_YEAR_IN_MODEL = False

SAMPLE_WEIGHT_ATTR = 'yieldObservations'

NON_Z_FIELDS = {
    'year',
    'geohash',
    'climateCounts',
    'yieldObservations'
}

TRAINING_INT_FIELDS = {
    'year',
    'climateCounts',
    'yieldObservations'
}

YIELD_FIELDS = {
    'yieldMean',
    'yieldStd'
}

NORM_YIELD_FIELDS = False

MODEL_TRANSFORM = True

NON_DELTA_FIELDS = [
    'year',
    'geohash',
    'baselineYieldMean',
    'baselineYieldStd',
    'yieldMean',
    'yieldStd',
    'yieldObservations'
]

TRAINING_STR_FIELDS = {'geohash'}

INVALID_VALUE = -999

UNIT_SIZE_IN_PIXELS = 8404  # 1196

RESOLUTION_SCALER = 1111  # 30m x 30m limited by 1km x 1km daily gridmet

DEFAULT_P_THRESHOLD = 0.05


def get_file_location(name):
    """Get the location to where a workspace file can be found or should be written.

    Args:
        name: The filename as a string.

    Returns:
        Relative path as string.
    """
    return os.path.join(WORKSPACE_DIR, name)
